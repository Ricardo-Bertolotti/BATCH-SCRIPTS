@ECHO OFF

CHCP 1252>NUL

SET LINHAS=ECHO ------------------------------------------------------------

ECHO.
%LINHAS%
ECHO.
ECHO GERADOR DE NÚMERO DE SÉRIE NO PADRÃO SAP
ECHO.
%LINHAS%
ECHO.

SET /P CENTRO=DIGITE O CENTRO : 
ECHO.

SETLOCAL ENABLEDELAYEDEXPANSION

SET /P MODELO=DIGITE O MODELO : 

SET ARG=!MODELO!

SET MIN=abcdefghijklmnopqrstuvwxyz
SET MAX=ABCDEFGHIJKLMNOPQRSTUVWXYZ

:CONVERSOR
SET /A CONT+=1

SET LETRAMIN=!MIN:~-%CONT%,1!
SET LETRAMAX=!MAX:~-%CONT%,1!

SET ARG=!ARG:%LETRAMIN%=%LETRAMAX%!

IF %CONT% == 26 (ENDLOCAL & SET "MODELO=%ARG%") ELSE (GOTO CONVERSOR)

ECHO.
SET /P DATA=DIGITE A DATA : 
ECHO.
SET /P HORA=DIGITE A HORA : 
IF %HORA% LSS 10 ( SET "HORA=0%HORA%" )
ECHO.
SET /P TURNO=DIGITE O TURNO : 
ECHO.
:LOOP_INICIO
SET /P INICIO=DIGITE O INICIO DA SEQUÊNCIA : 
IF %INICIO% GTR 99998 ( ECHO ERRO! VALOR INVALIDO... && GOTO LOOP_INICIO )

:LOOP_FINAL
ECHO.
SET /P FINAL=DIGITE O FINAL DA SEQUÊNCIA : 
IF %FINAL% LEQ %INICIO% ( ECHO ERRO! VALOR INVALIDO... && GOTO LOOP_FINAL )
IF %FINAL% GTR 99999 ( ECHO ERRO! VALOR INVALIDO... && GOTO LOOP_FINAL )
ECHO.
%LINHAS%

SET /A TOTAL_SN=%FINAL% - %INICIO% + 1

SET ALFABETO=ABCDEFGHIJKLMNOPQRSTUVWXYZ

SET ANO=%DATA:~4,2%

SETLOCAL ENABLEDELAYEDEXPANSION
SET MES=%DATA:~2,2%
IF "%MES:~0,1%"=="0" (
	SET MES=!MES:~1,1!
	GOTO SKIPMES
) ELSE (
	SET /A DIFMES=%MES%-10
)
SET MES=!ALFABETO:~%DIFMES%,1!
:SKIPMES
ENDLOCAL & SET "MES=%MES%"

SETLOCAL ENABLEDELAYEDEXPANSION
SET DIA=%DATA:~0,2%
IF "%DIA:~0,1%"=="0" (
	SET DIA=!DIA:~1,1!
	GOTO SKIPDIA
) ELSE (
	SET /A DIFDIA=%DIA%-10
)
SET DIA=!ALFABETO:~%DIFDIA%,1!
:SKIPDIA
ENDLOCAL & SET "DIA=%DIA%"

SET PREFIXO=%CENTRO:~0,1%%MODELO:~0,2%%ANO%%MES%%DIA%%HORA%%TURNO%
ECHO.
ECHO GERANDO OS NÚMEROS DE SÉRIE...
ECHO.
%LINHAS%

ECHO.
SETLOCAL ENABLEDELAYEDEXPANSION
SET /A CONTADOR_MAX=0
SET MAXIMO=%PREFIXO%99999

:LOOP_CONTADOR_MAXIMO

IF "%MAXIMO%" == "" ( SET MAXIMO=%CONTADOR_MAX% & GOTO FIM_LOOP_CONTADOR_MAXIMO )

IF %MAXIMO% NEQ "" (

	SET /A CONTADOR_MAX=%CONTADOR_MAX% + 1
 	SET MAXIMO=%MAXIMO:~0,-1%
 	GOTO LOOP_CONTADOR_MAXIMO
)

:FIM_LOOP_CONTADOR_MAXIMO

SET /A CONTADOR_MIN=0
SET MINIMO=%PREFIXO%%INICIO%

:LOOP_CONTADOR_MINIMO

IF "%MINIMO%" == "" ( SET MINIMO=%CONTADOR_MIN% & GOTO FIM_LOOP_CONTADOR_MINIMO )

IF %MINIMO% NEQ "" (

	SET /A CONTADOR_MIN=%CONTADOR_MIN% + 1
 	SET MINIMO=%MINIMO:~0,-1%
 	GOTO LOOP_CONTADOR_MINIMO
)

:FIM_LOOP_CONTADOR_MINIMO

SET /A DIFERENCA=%MAXIMO%-%MINIMO%

SET ZEROS=
SETLOCAL ENABLEDELAYEDEXPANSION
FOR /l %%i IN (1,1,%DIFERENCA%) DO SET ZEROS=!ZEROS!0
ENDLOCAL

SET /A FINAL=%FINAL% + 1

CLS

%LINHAS%
ECHO.
ECHO      GERANDO ARQUIVO DE TEXTO COM OS NÚMEROS DE SÉRIE...
ECHO.
ECHO            PREFIXO : %PREFIXO%...
ECHO.
%LINHAS%
ECHO.

IF EXIST "%~dp0NÚMEROS DE SÉRIE ( SAP ).txt" (
	DEL "%~dp0NÚMEROS DE SÉRIE ( SAP ).txt"
)

:LOOP


IF %INICIO% LSS %FINAL% (

	SET VAR=%INICIO%

) ELSE ( GOTO ENDIF )


SET /A CONTADOR_ATUAL=0
SET ATUAL=%PREFIXO%%VAR%


:INICIO_LOOP_CONTADOR_ATUAL

IF "%ATUAL%" == "" ( SET ATUAL=CONTADOR_ATUAL & GOTO FINAL_LOOP_CONTADOR_ATUAL )

SET ATUAL=%ATUAL:~0,-1%
SET /A CONTADOR_ATUAL=%CONTADOR_ATUAL% + 1

GOTO INICIO_LOOP_CONTADOR_ATUAL

:FINAL_LOOP_CONTADOR_ATUAL

SET /A DIFERENCA=%MAXIMO% - %CONTADOR_ATUAL%

SET ZEROS=
SETLOCAL ENABLEDELAYEDEXPANSION
FOR /l %%i IN (1,1,%DIFERENCA%) DO SET ZEROS=!ZEROS!0
ENDLOCAL & SET "ZEROS=%ZEROS%"

ECHO %PREFIXO%%ZEROS%%INICIO% >> "%~dp0NÚMEROS DE SÉRIE ( SAP ).txt"

SET /A INICIO=%VAR% + 1

GOTO LOOP

:ENDIF

COLOR 02
ECHO      ARQUIVO GERADO COM SUCESSO!     TOTAL DE NÚMEROS DE SÉRIE : ( %TOTAL_SN% )
ECHO.
ECHO      CAMINHO DO ARQUIVO : %~dp0NÚMEROS DE SÉRIE ( SAP ).txt
ECHO.
%LINHAS%
ECHO.

START "" "%~dp0NÚMEROS DE SÉRIE ( SAP ).txt"

PAUSE
